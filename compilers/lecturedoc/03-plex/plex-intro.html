
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Λεκτικοί αναλυτές με το module plex &#8212; Compiler Labs Doc 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mytheme.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Παράρτημα Α: Πληροφορίες για την Python3" href="../appendix-python/module1.html" />
    <link rel="prev" title="Κανονικές εκφράσεις και Python" href="../02-regex/module1.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
<div class="pageheader">
     <img src=../_static/banner.gif alt="mistral"/>
     <div>
        <h4>Τμήμα Πληροφορικής - Ιόνιο Πανεπιστήμιο</h4>
        <h2>Μεταγλωττιστές</h2>
        <h4>Εαρινό Εξάμηνο 2021-22</h4>        
        <h5>Μ.Στεφανιδάκης</h5>
      </div>    
</div>


  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <a class="reference internal image-reference" href="../_images/by-sa.png"><img alt="Creative Commons Attribution-ShareAlike 4.0 International License" src="../_images/by-sa.png" style="width: 80px;" /></a>
<section id="module-plex">
<h1>Λεκτικοί αναλυτές με το module plex<a class="headerlink" href="#module-plex" title="Permalink to this headline">¶</a></h1>
<p>Επιστρέφοντας στην πλήρη λεκτική ανάλυση πηγαίου κώδικα, χρειαζόμαστε κώδικα που αναλύει <strong>όλο το κείμενο εισόδου</strong>: δεν ψάχνουμε μόνο για μεμονωμένα ταιριάσματα, πρέπει να αναγνωρίζουμε τα πάντα, σε μη επικαλυπτόμενα ταιριάσματα.</p>
<p>Η λειτουργία αυτή θα μπορούσε θεωρητικά να επιτευχθεί με τα εργαλεία που έχουμε ήδη στη διάθεσή μας, τις κανονικές εκφράσεις της Python. Θα μπορούσαμε να κατασκευάσουμε κανονικές εκφράσεις, μία για κάθε είδος token που αναγνωρίζουμε, και να τις συνδυάσουμε σε μια μεγαλύτερη με εναλλαγές (<code class="docutils literal notranslate"><span class="pre">|</span></code>). Στη συνέχεια, με τη βοήθεια διαφορετικών groups θα ανιχνεύαμε τι έχει ταιριάξει και θα επιστρέφαμε το κατάλληλο token. Η διαδικασία θα ήταν επαναληπτική, μέχρι να εξαντληθεί όλος ο πηγαίος κώδικας. Ένα πολύ καλό <a class="reference external" href="https://docs.python.org/3/library/re.html#writing-a-tokenizer">παράδειγμα (“Writing a Tokenizer”)</a> μπορείτε να βρείτε στην τεκμηρίωση της βιβλιοθήκης <code class="docutils literal notranslate"><span class="pre">re</span></code> της Python.</p>
<p>Αυτή τη λειτουργία παρέχει το module <code class="docutils literal notranslate"><span class="pre">plex</span></code>, με έναν απλό και αντικειμενοστρεφή τρόπο.</p>
<div class="topic">
<p class="topic-title">Προσοχή: βιβλιοθήκη third-party</p>
<p>Το plex δεν ανήκει στην standard library της Python. Αν χρησιμοποιήσετε το <a class="reference external" href="https://mybinder.org/v2/gh/mixstef/mybinder-compilers/HEAD">on-line περιβάλλον</a>  στο Mybinder.org, το plex είναι προεγκατεστημένο. Αν δουλέψετε στον δικό σας υπολογιστή θα πρέπει να το εγκαταστήσετε εσείς:</p>
<ul class="simple">
<li><p>Η συνιστώμενη μέθοδος είναι μέσω ενός virtual environment. Δείτε τις οδηγίες για την <a class="reference internal" href="../appendix-python/module1.html#python-venv-ref"><span class="std std-ref">εγκατάσταση και χρήση virtual environments</span></a> στην Python.</p></li>
<li><p>Εναλλακτική μέθοδος (δεν συνιστάται, μόνο αν δεν μπορείτε με τον προηγούμενο τρόπο!): Κατεβάστε το αρχείο <code class="docutils literal notranslate"><span class="pre">plex.zip</span></code> από <a class="reference download internal" download="" href="../_downloads/70e565b10f51ac2fcd37efde11779107/plex.zip"><code class="xref download docutils literal notranslate"><span class="pre">εδώ</span></code></a>. Αποσυμπιέστε στον φάκελο που έχετε και τον δικό σας κώδικα (θα πρέπει να βλέπετε έναν φάκελο <code class="docutils literal notranslate"><span class="pre">plex</span></code> μαζί με τα δικά σας αρχεία python).</p></li>
</ul>
</div>
<section id="python">
<h2>Διαφορές με τις κανονικές εκφράσεις της Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h2>
<p>Το plex υλοποιεί τη μηχανή ταιριάσματος <strong>με ντετερμινιστικό αυτόματο (DFA)</strong>, χωρίς backtracking. Αυτό σημαίνει ότι <strong>δεν έχετε στη διάθεσή σας μη-άπληστους τελεστές ή backreferences</strong>, από την άλλη πλευρά όμως η απόδοση είναι ντετερμινιστική και δεν εξαρτάται από το πώς θα γράψετε το σχέδιο ταιριάσματος, ενώ εγγυημένα επιστρέφεται πάντοτε το μεγαλύτερο ταίριασμα.</p>
</section>
<section id="id1">
<h2>Χρήση του module plex<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Στη συνέχεια περιγράφονται τα βασικά βήματα για τη χρήση του <code class="docutils literal notranslate"><span class="pre">plex</span></code>.</p>
<ol class="arabic">
<li><p>Κάνετε import το plex</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plex</span>
</pre></div>
</div>
</li>
<li><p>Στη συνέχεια προσδιορίστε τα patterns που θα αναγνωρίζονται (εδώ, τα strings <code class="docutils literal notranslate"><span class="pre">abc</span></code> και <code class="docutils literal notranslate"><span class="pre">123</span></code>, καθώς και διάφοροι χαρακτήρες whitespace):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">text_abc</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
<span class="n">text_123</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
<span class="n">spaces</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\\</span><span class="s1">t</span><span class="se">\\</span><span class="s1">n&#39;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p>Δημιουργήστε ένα <code class="docutils literal notranslate"><span class="pre">plex.Lexicon</span></code> με ζευγάρια (pattern,action). Με τον τρόπο αυτόν λέτε στο plex τι θέλετε να αναγνωρίσετε και τι πρέπει να επιστρέφεται κάθε φορά:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">lexicon</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Lexicon</span><span class="p">([</span>
            <span class="p">(</span><span class="n">text_abc</span><span class="p">,</span><span class="s1">&#39;ABC_TOKEN&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">text_123</span><span class="p">,</span><span class="s1">&#39;123_TOKEN&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">spaces</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">)</span>
          <span class="p">])</span>
</pre></div>
</div>
<p>Η δημιουργία του <code class="docutils literal notranslate"><span class="pre">plex.Lexicon</span></code> ισοδυναμεί με την κατασκευή του αυτομάτου αναγνώρισης (ή αλλιώς, είναι αντίστοιχο του <code class="docutils literal notranslate"><span class="pre">re.compile()</span></code> των κανονικών εκφράσεων της Python).</p>
<p>Στο προηγούμενο παράδειγμα προσδιορίζουμε ότι:</p>
<ul class="simple">
<li><p>Αν αναγνωριστεί το <code class="docutils literal notranslate"><span class="pre">abc</span></code>, να επιστραφεί το token <code class="docutils literal notranslate"><span class="pre">ABC_TOKEN</span></code>.</p></li>
<li><p>Αν αναγνωριστεί το <code class="docutils literal notranslate"><span class="pre">123</span></code>, να επιστραφεί το token <code class="docutils literal notranslate"><span class="pre">123_TOKEN</span></code>.</p></li>
<li><p>Αν αναγνωριστούν κενά (whitespaces), να αγνοηθούν. Το <code class="docutils literal notranslate"><span class="pre">plex.IGNORE</span></code> λέει στο plex να καταναλώσει τους χαρακτήρες αυτούς χωρίς να επιστρέψει κανένα token.</p></li>
</ul>
</li>
<li><p>Ανοίξτε το αρχείο εισόδου και δημιουργήστε έναν <em>scanner</em> (λεκτικό αναλυτή) για το <code class="docutils literal notranslate"><span class="pre">plex.Lexicon</span></code> που φτιάξατε προηγουμένως.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;plex-123-abc.txt&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">scanner</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Scanner</span><span class="p">(</span><span class="n">lexicon</span><span class="p">,</span><span class="n">fp</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>Στη συνέχεια, διαβάστε επαναληπτικά τα ζευγάρια (token,lexeme) που επιστρέφει η μέθοδος <code class="docutils literal notranslate"><span class="pre">scanner.read()</span></code> μέχρι το τέλος του κειμένου (μέχρι να επιστραφεί το token <code class="docutils literal notranslate"><span class="pre">None</span></code>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">token</span><span class="p">,</span><span class="n">lexeme</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span> <span class="k">break</span> <span class="c1"># reached end-of-text (EOT)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">lexeme</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
<p>Το <a class="reference download internal" download="" href="../_downloads/ea5c96dc5c38689d90c0fb5e842459ca/plex-123-abc.py"><code class="xref download docutils literal notranslate"><span class="pre">πλήρες</span> <span class="pre">πρόγραμμα</span></code></a> φαίνεται στη συνέχεια:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plex</span>


<span class="n">text_abc</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
<span class="n">text_123</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s1">&#39;123&#39;</span><span class="p">)</span>
<span class="n">spaces</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\t\n</span><span class="s1">&#39;</span><span class="p">))</span>

<span class="n">lexicon</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Lexicon</span><span class="p">([</span>
        <span class="p">(</span><span class="n">text_abc</span><span class="p">,</span><span class="s1">&#39;ABC_TOKEN&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">text_123</span><span class="p">,</span><span class="s1">&#39;123_TOKEN&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">spaces</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">)</span>
      <span class="p">])</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;plex-123-abc.txt&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>

    <span class="n">scanner</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Scanner</span><span class="p">(</span><span class="n">lexicon</span><span class="p">,</span><span class="n">fp</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">token</span><span class="p">,</span><span class="n">lexeme</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    
        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span> <span class="k">break</span>	<span class="c1"># reached end-of-text (EOT)</span>
    
        <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">lexeme</span><span class="p">)</span>	
        

</pre></div>
</div>
<p>Το αρχείο κειμένου εισόδου <a class="reference download internal" download="" href="../_downloads/9884d897e1121c6d66d8f4691774fcf1/plex-123-abc.txt"><code class="xref download docutils literal notranslate"><span class="pre">plex-123-abc.txt</span></code></a> μπορεί π.χ. να περιέχει:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>abc 123 abc
123 abc
abc123
</pre></div>
</div>
<div class="topic">
<p class="topic-title">Είσοδος από string</p>
<p>Θα έχετε παρατηρήσει ότι το <code class="docutils literal notranslate"><span class="pre">plex</span></code> μπορεί να αναλύσει μόνο κείμενο από αρχεία. Πώς είναι δυνατή η ανάλυση ενός string; Εδώ έρχεται προς βοήθεια η κλάση <code class="docutils literal notranslate"><span class="pre">io.StringIO</span></code> της Python που παρέχει αντικείμενα string που συμπεριφέρονται ως αρχεία:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">abc 123 abc</span>
<span class="s2">123 abc</span>
<span class="s2">abc123</span>

<span class="s2">&quot;&quot;&quot;</span>

<span class="n">scanner</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Scanner</span><span class="p">(</span><span class="n">lexicon</span><span class="p">,</span><span class="n">StringIO</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
<section id="plex-patterns">
<h2>Plex patterns<a class="headerlink" href="#plex-patterns" title="Permalink to this headline">¶</a></h2>
<p>Αν S, S1, S2 είναι strings, και Β, Ε χαρακτήρες, μπορούν να κατασκευαστούν τα εξής patterns ταιριάσματος:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>plex.Str(S)</p></td>
<td><p>ταιριάζει το string S</p></td>
</tr>
<tr class="row-even"><td><p>plex.Str(S1,S2,..)</p></td>
<td><p>ταιριάζει ένα από τα S1, S2, ..</p></td>
</tr>
<tr class="row-odd"><td><p>plex.Any(S)</p></td>
<td><p>ταιριάζει κάθε έναν από τους χαρακτήρες του S</p></td>
</tr>
<tr class="row-even"><td><p>plex.AnyBut(S)</p></td>
<td><p>ταιριάζει κάθε χαρακτήρα που δεν ανήκει στο S</p></td>
</tr>
<tr class="row-odd"><td><p>plex.AnyChar</p></td>
<td><p>ταιριάζει κάθε μονό χαρακτήρα (και το newline)</p></td>
</tr>
<tr class="row-even"><td><p>plex.Empty</p></td>
<td><p>ταιριάζει το κενό string</p></td>
</tr>
<tr class="row-odd"><td><p>plex.Bol,plex.Eol,plex.Eof</p></td>
<td><p>ταιριάζει στην αρχή/τέλος γραμμής και τέλος κειμένου</p></td>
</tr>
<tr class="row-even"><td><p>plex.Range(‘BE’)</p></td>
<td><p>ταιριάζει περιοχές από το Β έως το Ε (και πολλαπλές π.χ. ‘AZaz’)</p></td>
</tr>
</tbody>
</table>
<p>Επίσης, αν P, P1, P2 είναι patterns που έχουν ήδη κατασκευαστεί, μπορούν να γίνουν οι εξής συνδυασμοί:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 31%" />
<col style="width: 69%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>P1+P2</p></td>
<td><p>το P1 ακολουθούμενο από το P2</p></td>
</tr>
<tr class="row-even"><td><p>P1|P2</p></td>
<td><p>είτε το P1 είτε το P2 (εναλλαγή)</p></td>
</tr>
<tr class="row-odd"><td><p>plex.Opt(P)</p></td>
<td><p>0 ή 1 φορά το P (προαιρετικό)</p></td>
</tr>
<tr class="row-even"><td><p>plex.Rep(P)</p></td>
<td><p>0 ή περισσότερες φορές το P</p></td>
</tr>
<tr class="row-odd"><td><p>plex.Rep1(P)</p></td>
<td><p>1 ή περισσότερες φορές το P</p></td>
</tr>
<tr class="row-even"><td><p>plex.NoCase(P),plex.Case(P)</p></td>
<td><p>το P, αγνοώντας (ή λαμβάνοντας υπ’όψη) κεφαλαία-μικρά</p></td>
</tr>
</tbody>
</table>
<p>(για την πλήρη τεκμηρίωση του plex δείτε το <a class="reference external" href="https://pythonhosted.org/plex/">https://pythonhosted.org/plex/</a>)</p>
</section>
<section id="plex">
<h2>Plex και χειρισμός σφαλμάτων<a class="headerlink" href="#plex" title="Permalink to this headline">¶</a></h2>
<p>Κατά τη λειτουργία ενός λεκτικού αναλυτή απαιτείται η αναγνώριση του πλήρους κειμένου: δεν μπορούν να υπάρχουν χαρακτήρες που δεν ταιριάζουν με κάποιο σχέδιο (pattern) του λεκτικού αναλυτή. Αν συμβεί κάτι τέτοιο, προκαλείται <strong>σφάλμα λεκτικής ανάλυσης</strong>.</p>
<p>Το <code class="docutils literal notranslate"><span class="pre">plex</span></code> θα σταματήσει την ανάλυση όταν δεν μπορεί να αναγνωρίσει μέρος της εισόδου με το <code class="docutils literal notranslate"><span class="pre">plex.Lexicon</span></code> που χρησιμοποιεί. Μπορείτε να χειριστείτε το σφάλμα ως εξής (<a class="reference download internal" download="" href="../_downloads/f74f6d272c00642438176a40ad5694e8/plex-123-abc-error-handling.py"><code class="xref download docutils literal notranslate"><span class="pre">πλήρες</span> <span class="pre">αρχείο</span> <span class="pre">Python</span></code></a>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;plex-123-abc-other.txt&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>

    <span class="n">scanner</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Scanner</span><span class="p">(</span><span class="n">lexicon</span><span class="p">,</span><span class="n">fp</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">token</span><span class="p">,</span><span class="n">lexeme</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">except</span> <span class="n">plex</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">PlexError</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">position</span><span class="p">()</span>        <span class="c1"># lineno is 1-based, charno is 0-based</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scanner Error at line </span><span class="si">{}</span><span class="s2"> char </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">break</span>       <span class="c1"># lexical analysis ends after error</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span> <span class="k">break</span>     <span class="c1"># reached end-of-text (EOT)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">lexeme</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2>Κανόνες ταιριάσματος<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>Γνωρίζουμε ήδη ότι το <code class="docutils literal notranslate"><span class="pre">plex</span></code> επιστρέφει πάντα το <strong>μεγαλύτερο σε μήκος ταίριασμα</strong>. Τι συμβαίνει όμως όταν υπάρχουν δύο επιλογές <em>με το ίδιο ακριβώς μήκος</em>;</p>
<p>Στο <code class="docutils literal notranslate"><span class="pre">plex.Lexicon</span></code> που ακολουθεί, η είσοδος <code class="docutils literal notranslate"><span class="pre">then</span></code> ταιριάζει τόσο με το σχέδιο <em>keywords</em> («ένα από τα if, then, else») όσο και με το <em>name</em> («ονόματα μεταβλητών»). Σε τέτοιες περιπτώσεις, το <code class="docutils literal notranslate"><span class="pre">plex</span></code> ταιριάζει <strong>το pattern που δηλώθηκε πρώτο</strong> στο <code class="docutils literal notranslate"><span class="pre">plex.Lexicon</span></code> (δηλαδή, εδώ θα ταιριάξει το <em>keywords</em> κι όχι το <em>name</em>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># define patterns</span>
<span class="n">letter</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s2">&quot;AZaz&quot;</span><span class="p">)</span>
<span class="n">digit</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s2">&quot;09&quot;</span><span class="p">)</span>
<span class="n">underscore</span> <span class="o">=</span>  <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>

<span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="n">letter</span> <span class="o">|</span> <span class="n">underscore</span><span class="p">)</span> <span class="o">+</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep</span><span class="p">(</span><span class="n">letter</span> <span class="o">|</span> <span class="n">digit</span> <span class="o">|</span> <span class="n">underscore</span><span class="p">)</span>
<span class="n">spaces</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="s2">&quot; </span><span class="se">\t\n</span><span class="s2">&quot;</span><span class="p">))</span>

<span class="n">keywords</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s2">&quot;if&quot;</span><span class="p">,</span><span class="s2">&quot;then&quot;</span><span class="p">,</span><span class="s2">&quot;else&quot;</span><span class="p">)</span>

<span class="c1"># the scanner lexicon</span>
<span class="n">lexicon</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Lexicon</span><span class="p">([</span>
    <span class="p">(</span><span class="n">keywords</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">TEXT</span><span class="p">),</span>
    <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;IDENTIFIER&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">spaces</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">)</span>
    <span class="p">])</span>
</pre></div>
</div>
<p><strong>Σημ.:</strong> Το <code class="docutils literal notranslate"><span class="pre">plex.TEXT</span></code> που φαίνεται στο προηγούμενο <code class="docutils literal notranslate"><span class="pre">plex.Lexicon</span></code> λέει στο <code class="docutils literal notranslate"><span class="pre">plex</span></code> να επιστρέψει ως token το κείμενο που ταίριαξε (lexeme), δηλ. εδώ ένα από τα <code class="docutils literal notranslate"><span class="pre">if</span></code>, <code class="docutils literal notranslate"><span class="pre">then</span></code>, <code class="docutils literal notranslate"><span class="pre">else</span></code>.</p>
</section>
<section id="id3">
<h2>Παράδειγμα #1: Λέξεις και αριθμοί<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>Στο επόμενο περιγράφεται λεκτικός αναλυτής με τη βοήθεια του plex, ο οποίος αναγνωρίζει</p>
<ul class="simple">
<li><p><em>Λέξεις:</em> συνεχόμενες σειρές από λατινικά γράμματα (κεφαλαία-πεζά)</p></li>
<li><p><em>Αριθμούς:</em> συνεχόμενες σειρές από ψηφία (0 έως 9).</p></li>
<li><p>Κενά, tabs, newlines που αγνοούνται.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plex</span>


<span class="c1"># define patterns</span>
<span class="n">letter</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s2">&quot;AZaz&quot;</span><span class="p">)</span>
<span class="n">digit</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s2">&quot;09&quot;</span><span class="p">)</span>

<span class="n">word</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span>
<span class="n">number</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span>
<span class="n">spaces</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\t\n</span><span class="s1">&#39;</span><span class="p">))</span>

<span class="c1"># the scanner lexicon - a list of (pattern,action ) tuples</span>
<span class="n">lexicon</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Lexicon</span><span class="p">([</span>
    <span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="s2">&quot;WORD_TOKEN&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">number</span><span class="p">,</span><span class="s2">&quot;NUMBER_TOKEN&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="n">spaces</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">)</span>
    <span class="p">])</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;plex-words-numbers.txt&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>

    <span class="n">scanner</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Scanner</span><span class="p">(</span><span class="n">lexicon</span><span class="p">,</span><span class="n">fp</span><span class="p">)</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">token</span><span class="p">,</span><span class="n">lexeme</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            
        <span class="k">except</span> <span class="n">plex</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">PlexError</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">position</span><span class="p">()</span>	<span class="c1"># lineno is 1-based, charno is 0-based</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scanner Error at line </span><span class="si">{}</span><span class="s2"> char </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">break</span>	<span class="c1"># lexical analysis ends after error</span>
    
        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span> <span class="k">break</span>	<span class="c1"># reached end-of-text (EOT)</span>
    
        <span class="nb">print</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">lexeme</span><span class="p">)</span>	
        

</pre></div>
</div>
<p>Μπορείτε να κατεβάσετε τα αρχεία με τον <a class="reference download internal" download="" href="../_downloads/e7b2b5fa19283403cd815b72dd02f8d7/plex-words-numbers.py"><code class="xref download docutils literal notranslate"><span class="pre">κώδικα</span> <span class="pre">Python</span></code></a> και το <a class="reference download internal" download="" href="../_downloads/c10cc67e59109030bc78f84cb448180b/plex-words-numbers.txt"><code class="xref download docutils literal notranslate"><span class="pre">δοκιμαστικό</span> <span class="pre">κείμενο</span></code></a> του παραδείγματος.</p>
</section>
<section id="postfix-calculator">
<h2>Παράδειγμα #2: Postfix calculator<a class="headerlink" href="#postfix-calculator" title="Permalink to this headline">¶</a></h2>
<p>Το plex ως λεκτικός αναλυτής επιστρέφει μια σειρά από tokens χωρίς να εκτελεί οποιουδήποτε τύπου συντακτική ανάλυση. Έτσι, δεν είναι εύκολο να φτιαχτεί χρήσιμη εφαρμογή μόνο με το plex. Υπάρχει όμως ένας τρόπος γραφής αριθμητικών εκφράσεων (<a class="reference external" href="https://en.wikipedia.org/wiki/Reverse_Polish_notation">postfix notation</a>), ο οποίος επιτρέπει τον υπολογισμό τους χωρίς συντακτική ανάλυση. Το παράδειγμα αυτό θα δούμε στη συνέχεια.</p>
<p>Στη μορφή <em>postfix</em> ο τελεστής γράφεται αμέσως μετά τα δεδομένα εισόδου. Π.χ. η έκφραση <code class="docutils literal notranslate"><span class="pre">3+5</span></code> γράφεται ως:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>3 5 +
</pre></div>
</div>
<p>ενώ η έκφραση <code class="docutils literal notranslate"><span class="pre">8*(3+2)</span></code> γράφεται ως:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>8 3 2 + *
</pre></div>
</div>
<p>Εάν κάθε τελεστής έχει προκαθορισμένο αριθμό εισόδων (π.χ. το <code class="docutils literal notranslate"><span class="pre">+</span></code> δέχεται δύο εισόδους), τότε μπορείτε να υπολογίσετε την αριθμητική έκφραση χωρίς συντακτική ανάλυση, με τη βοήθεια μιας <em>στοίβας (stack)</em> και σύμφωνα με τον εξής αλγόριθμο:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Για κάθε token εισόδου:
        Εάν το token είναι αριθμός:
                Βάλε (push) τον αριθμό στη στοίβα
        Αλλιώς, αν είναι τελεστής:
                Πάρε (pop) από τη στοίβα όσα στοιχεία χρειάζεται ο τελεστής
                Κάνε την πράξη
                Βάλε (push) το αποτέλεσμα στη στοίβα

Όταν εξαντληθούν τα tokens εισόδου, στην κορυφή της στοίβας θα βρίσκεται το τελικό αποτέλεσμα.
</pre></div>
</div>
<div class="topic">
<p class="topic-title">Μια (στοιχειώδης) υλοποίηση στοίβας (stack)</p>
<p>Στην Python είναι πολύ εύκολο να φτιάξουμε μια στοίβα χρησιμοποιώντας μια λίστα (list). Για ευκολία, στα επόμενα χρησιμοποιούμε την έτοιμη κλάση <code class="docutils literal notranslate"><span class="pre">Stack</span></code> που βρίσκεται στο module <code class="docutils literal notranslate"><span class="pre">mystack</span></code>. Η κλάση παρέχει μόνο τις βασικές λειτουργίες <em>push</em> και <em>pop</em>, ενώ δημιουργείται σφάλμα εάν προσπαθήσετε να εξάγετε στοιχείο όταν η στοίβα είναι άδεια. Στο <a class="reference external" href="https://mybinder.org/v2/gh/mixstef/mybinder-compilers/HEAD">on-line περιβάλλον</a>  στο Mybinder.org, το module <code class="docutils literal notranslate"><span class="pre">mystack</span></code> είναι προεγκατεστημένο. Για τον υπολογιστή σας πρέπει να κατεβάσετε το module (<a class="reference download internal" download="" href="../_downloads/c3b9982d6575494990ba96b2c09878f6/mystack.py"><code class="xref download docutils literal notranslate"><span class="pre">αρχείο</span> <span class="pre">mystack.py</span></code></a>) και να το τοποθετήσετε μαζί με τα δικά σας αρχεία Python.</p>
<p>Παραδείγματα χρήσης της κλασης <code class="docutils literal notranslate"><span class="pre">Stack</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mystack</span> <span class="kn">import</span> <span class="n">Stack</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mf">12.34</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mf">9.22</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="go">9.22</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="mi">49</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="go">49</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="go">12.34</span>
</pre></div>
</div>
</div>
<p>Το επόμενο πρόγραμμα Python υλοποιεί τον αλγόριθμο για υπολογισμό αριθμητικών εκφράσεων σε postfix μορφή. Οι υποστηριζόμενοι τελεστές ειναι οι <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code> και ο ψευδοτελεστής <code class="docutils literal notranslate"><span class="pre">?</span></code>, ο οποίος τυπώνει ό,τι βρίσκεται στην κορυφή της στοίβας εκείνη τη στιγμή.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plex</span>

<span class="kn">from</span> <span class="nn">mystack</span> <span class="kn">import</span> <span class="n">Stack</span><span class="p">,</span><span class="n">StackError</span>

<span class="c1"># pattern definitions</span>
<span class="n">digit</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="s1">&#39;09&#39;</span><span class="p">)</span>
<span class="n">number</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span> <span class="o">+</span> <span class="n">plex</span><span class="o">.</span><span class="n">Opt</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Str</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">digit</span><span class="p">))</span>
<span class="n">operator</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="s1">&#39;+-*/?&#39;</span><span class="p">)</span>
<span class="n">spaces</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Rep1</span><span class="p">(</span><span class="n">plex</span><span class="o">.</span><span class="n">Any</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\t\n</span><span class="s1">&#39;</span><span class="p">))</span>

<span class="c1"># the scanner lexicon</span>
<span class="n">lexicon</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Lexicon</span><span class="p">([</span>
      <span class="p">(</span><span class="n">number</span><span class="p">,</span><span class="s1">&#39;NUMBER&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">operator</span><span class="p">,</span><span class="s1">&#39;OPERATOR&#39;</span><span class="p">),</span>
      <span class="p">(</span><span class="n">spaces</span><span class="p">,</span><span class="n">plex</span><span class="o">.</span><span class="n">IGNORE</span><span class="p">)</span>
    <span class="p">])</span>

<span class="c1"># functions per operator</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">stack</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">stack</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>	<span class="c1"># a,b order matters!</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">mult</span><span class="p">(</span><span class="n">stack</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">stack</span><span class="p">):</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>	<span class="c1"># a,b order matters!</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="n">stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">prn</span><span class="p">(</span><span class="n">stack</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>	<span class="c1"># put back item in stack</span>

<span class="c1"># dict of operator functions</span>
<span class="n">fn</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;+&#39;</span><span class="p">:</span><span class="n">add</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span><span class="n">sub</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">:</span><span class="n">mult</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span><span class="n">div</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">:</span><span class="n">prn</span> <span class="p">}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;rpn.txt&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>

    <span class="n">scanner</span> <span class="o">=</span> <span class="n">plex</span><span class="o">.</span><span class="n">Scanner</span><span class="p">(</span><span class="n">lexicon</span><span class="p">,</span><span class="n">fp</span><span class="p">)</span>

    <span class="n">stack</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">()</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    
        <span class="k">try</span><span class="p">:</span>       
            <span class="n">token</span><span class="p">,</span><span class="n">lexeme</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">token</span><span class="o">==</span><span class="s1">&#39;NUMBER&#39;</span><span class="p">:</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lexeme</span><span class="p">))</span>	<span class="c1"># push into stack arithmetic value</span>
            
            <span class="k">elif</span> <span class="n">token</span><span class="o">==</span><span class="s1">&#39;OPERATOR&#39;</span><span class="p">:</span>
                <span class="n">fn</span><span class="p">[</span><span class="n">lexeme</span><span class="p">](</span><span class="n">stack</span><span class="p">)</span>	<span class="c1"># call operator&#39;s function</span>
            
        <span class="k">except</span> <span class="n">plex</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">PlexError</span><span class="p">:</span>            
            <span class="n">_</span><span class="p">,</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">position</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scanner Error at line </span><span class="si">{}</span><span class="s2"> char </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">break</span>	<span class="c1"># lexical analysis ends after errors</span>
            
        <span class="k">except</span> <span class="n">StackError</span><span class="p">:</span>        
            <span class="n">_</span><span class="p">,</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="n">position</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input error at line </span><span class="si">{}</span><span class="s2"> char </span><span class="si">{}</span><span class="s2">: stack is empty&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lineno</span><span class="p">,</span><span class="n">charno</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">break</span>	<span class="c1"># lexical analysis ends after errors</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="p">:</span> <span class="k">break</span>	<span class="c1"># reached end-of-text (EOT)</span>

</pre></div>
</div>
<p>Στο προηγούμενο παράδειγμα, χρησιμοποιούμε μια συνάρτηση ανά τελεστή και ένα dictionary για να επιλέγουμε συνάρτηση ανάλογα με τον τελεστή. Θα μπορούσατε εναλλακτικά να υλοποιήσετε τον κώδικα με μια σειρά από <code class="docutils literal notranslate"><span class="pre">if..elif..elif..else</span></code>.</p>
<p>Μπορείτε να κατεβάσετε τα αρχεία με τον <a class="reference download internal" download="" href="../_downloads/2aed1114bf1d7ad9842cbfbe08ce845d/rpn.py"><code class="xref download docutils literal notranslate"><span class="pre">κώδικα</span> <span class="pre">Python</span></code></a> και το <a class="reference download internal" download="" href="../_downloads/f53e78174b28b7aa171cd5aa127d42de/rpn.txt"><code class="xref download docutils literal notranslate"><span class="pre">δοκιμαστικό</span> <span class="pre">κείμενο</span> <span class="pre">εισόδου</span></code></a> του παραδείγματος, που υπολογίζει την έκφραση <code class="docutils literal notranslate"><span class="pre">1.1+(10-7)*(6/2)</span></code>.</p>
</section>
<section id="id5">
<h2>Ασκήσεις<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Κατασκευάστε με τη βοήθεια του module <code class="docutils literal notranslate"><span class="pre">plex</span></code> λεκτικό αναλυτή ο οποίος θα αναγνωρίζει αριθμητικές σταθερές (literals) στις εξής μορφές:</p></li>
</ol>
<blockquote>
<div><ul class="simple">
<li><p>ακέραιες σταθερές (σειρές από ψηφία 0-9 οποιουδήποτε μήκους)</p></li>
<li><p>κλασματικές (float) σταθερές στη μορφή <code class="docutils literal notranslate"><span class="pre">xxx.yyy</span></code>, <code class="docutils literal notranslate"><span class="pre">.yyy</span></code> και <code class="docutils literal notranslate"><span class="pre">xxx.</span></code> (με οποιοδήποτε μήκος x και y)</p></li>
<li><p>δεκαεξαδικές σταθερές (hex), στη μορφή <code class="docutils literal notranslate"><span class="pre">0x****</span></code> όπου το <code class="docutils literal notranslate"><span class="pre">*</span></code> αντιστοιχεί σε ένα δεκαεξαδικό ψηφίο (0-9, a-f, A-F) (για οποιονδήποτε αριθμό ψηφίων)</p></li>
</ul>
<p>Ο λεκτικός αναλυτής θα πρέπει να επιστρέφει <code class="docutils literal notranslate"><span class="pre">INT_TOKEN</span></code>, <code class="docutils literal notranslate"><span class="pre">FLOAT_TOKEN</span></code> και <code class="docutils literal notranslate"><span class="pre">HEX_TOKEN</span></code>, αντίστοιχα.</p>
</div></blockquote>
<ol class="arabic simple" start="2">
<li><p>Προσπαθήστε να προσθέσετε στον προηγούμενο λεκτικό αναλυτή τη δυνατότητα αναγνώρισης <strong>σχολίων μονής γραμμής</strong> στο στυλ της C: ξεκινώντας από <code class="docutils literal notranslate"><span class="pre">\\</span></code> και έως το τέλος της γραμμής (μέχρι να βρείτε newline). Τα σχόλια θα πρέπει να αγνοούνται (με το plex.IGNORE).</p></li>
</ol>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Περιεχόμενα</a></h3>
  <ul>
<li><a class="reference internal" href="#">Λεκτικοί αναλυτές με το module plex</a><ul>
<li><a class="reference internal" href="#python">Διαφορές με τις κανονικές εκφράσεις της Python</a></li>
<li><a class="reference internal" href="#id1">Χρήση του module plex</a></li>
<li><a class="reference internal" href="#plex-patterns">Plex patterns</a></li>
<li><a class="reference internal" href="#plex">Plex και χειρισμός σφαλμάτων</a></li>
<li><a class="reference internal" href="#id2">Κανόνες ταιριάσματος</a></li>
<li><a class="reference internal" href="#id3">Παράδειγμα #1: Λέξεις και αριθμοί</a></li>
<li><a class="reference internal" href="#postfix-calculator">Παράδειγμα #2: Postfix calculator</a></li>
<li><a class="reference internal" href="#id5">Ασκήσεις</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      
      
    </div>

    

    
  </body>
</html>